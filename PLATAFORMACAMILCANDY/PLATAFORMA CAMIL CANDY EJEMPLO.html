<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candy Cami - Punto de Venta</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #ff6b8b;
            --secondary-color: #6a11cb;
            --accent-color: #ffa726;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --sidebar-width: 250px;
            --sidebar-collapsed: 70px;
            --border-radius: 8px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: var(--dark-color);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--secondary-color), #2575fc);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            font-size: 2rem;
            color: var(--accent-color);
        }

        .sidebar-header h2 {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .sidebar-header span {
            color: var(--accent-color);
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--accent-color);
        }

        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            border-left-color: var(--accent-color);
        }

        .menu-item i {
            width: 25px;
            font-size: 1.2rem;
            margin-right: 15px;
        }

        .menu-item span {
            font-weight: 500;
        }

        .sidebar-footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.8rem;
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
        }

        .sidebar-toggle {
            position: absolute;
            top: 20px;
            right: -15px;
            background-color: var(--accent-color);
            color: var(--dark-color);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            z-index: 1001;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: margin-left 0.3s ease;
            min-height: 100vh;
        }

        .main-content.collapsed {
            margin-left: var(--sidebar-collapsed);
        }

        .top-header {
            background-color: white;
            padding: 20px 30px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .page-title {
            color: var(--secondary-color);
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .content-wrapper {
            padding: 30px;
        }

        /* Content Section Styles */
        .content-section {
            display: none;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section-title {
            color: var(--secondary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Product Management Styles */
        .product-form {
            background-color: #f8f9fa;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
            min-width: 250px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 107, 139, 0.2);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #ff557a;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-info {
            background-color: var(--info-color);
            color: white;
        }

        .btn-info:hover {
            background-color: #138496;
        }

        /* Products Table */
        .products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .products-table th {
            background-color: var(--secondary-color);
            color: white;
            text-align: left;
            padding: 15px;
        }

        .products-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .products-table tr:hover {
            background-color: #f8f9fa;
        }

        .inventory-low {
            color: var(--danger-color);
            font-weight: bold;
        }

        .inventory-ok {
            color: var(--success-color);
            font-weight: bold;
        }

        .badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-concentrado {
            background-color: #d1ecf1;
            color: #0c5460;
        }

        .badge-embolsado {
            background-color: #d4edda;
            color: #155724;
        }

        /* Point of Sale Styles */
        .pos-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .products-grid {
            flex: 2;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .product-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: transform 0.2s ease;
            border: 2px solid transparent;
        }

        .product-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
        }

        .product-card.selected {
            border-color: var(--success-color);
            background-color: #f8fff9;
        }

        .product-card h4 {
            color: var(--secondary-color);
            margin-bottom: 5px;
        }

        .product-card .price {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        .product-card .inventory {
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .sale-sidebar {
            flex: 1;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 20px;
            min-width: 300px;
        }

        .cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cart-item-quantity button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }

        .cart-total {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary-color);
            text-align: right;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #ddd;
        }

        /* Reportes Styles */
        .report-filters {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
            align-items: flex-end;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .reports-tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: var(--dark-color);
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            color: var(--primary-color);
        }

        .tab-btn.active {
            color: var(--secondary-color);
            border-bottom: 3px solid var(--secondary-color);
        }

        .report-content {
            display: none;
        }

        .report-content.active {
            display: block;
        }

        .report-summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .summary-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            border-top: 4px solid var(--primary-color);
        }

        .summary-card h4 {
            color: var(--dark-color);
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--secondary-color);
        }

        .summary-card .subtext {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        /* Alert Styles */
        .alert {
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border-left: 5px solid var(--success-color);
        }

        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border-left: 5px solid var(--warning-color);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            color: var(--secondary-color);
            font-size: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-color);
        }

        /* Data Management */
        .data-management {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 30px;
        }

        .data-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Collapsed Sidebar Styles */
        .sidebar.collapsed {
            width: var(--sidebar-collapsed);
        }

        .sidebar.collapsed .sidebar-header h2,
        .sidebar.collapsed .menu-item span,
        .sidebar.collapsed .sidebar-footer {
            display: none;
        }

        .sidebar.collapsed .sidebar-header {
            justify-content: center;
            padding: 25px 10px;
        }

        .sidebar.collapsed .menu-item {
            justify-content: center;
            padding: 15px 10px;
        }

        .sidebar.collapsed .menu-item i {
            margin-right: 0;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .sidebar {
                width: var(--sidebar-collapsed);
            }
            
            .sidebar .sidebar-header h2,
            .sidebar .menu-item span,
            .sidebar .sidebar-footer {
                display: none;
            }
            
            .sidebar .sidebar-header {
                justify-content: center;
                padding: 25px 10px;
            }
            
            .sidebar .menu-item {
                justify-content: center;
                padding: 15px 10px;
            }
            
            .sidebar .menu-item i {
                margin-right: 0;
            }
            
            .main-content {
                margin-left: var(--sidebar-collapsed);
            }
            
            .sidebar-toggle {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .pos-container {
                flex-direction: column;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .data-buttons {
                flex-direction: column;
            }
            
            .filter-row {
                flex-direction: column;
            }
            
            .report-summary-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .top-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
        }

        @media (max-width: 576px) {
            .content-wrapper {
                padding: 15px;
            }
            
            .report-summary-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo-icon">
                <i class="fas fa-candy-cane"></i>
            </div>
            <div>
                <h2>Candy <span>Cami</span></h2>
            </div>
        </div>
        
        <div class="sidebar-toggle" id="sidebarToggle">
            <i class="fas fa-chevron-left" id="toggleIcon"></i>
        </div>
        
        <div class="sidebar-menu">
            <div class="menu-item active" data-section="inventory">
                <i class="fas fa-boxes"></i>
                <span>Gestión de Inventario</span>
            </div>
            <div class="menu-item" data-section="pos">
                <i class="fas fa-cash-register"></i>
                <span>Punto de Venta</span>
            </div>
            <div class="menu-item" data-section="reports">
                <i class="fas fa-chart-bar"></i>
                <span>Reportes</span>
            </div>
            <div class="menu-item" data-section="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </div>
            <div class="menu-item" data-section="settings">
                <i class="fas fa-cog"></i>
                <span>Configuración</span>
            </div>
        </div>
        
        <div class="sidebar-footer">
            <p>Candy Cami v1.0</p>
            <p>© 2023 Todos los derechos reservados</p>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content" id="mainContent">
        <!-- Top Header -->
        <div class="top-header">
            <div class="page-title" id="pageTitle">
                <i class="fas fa-boxes"></i>
                <span>Gestión de Inventario</span>
            </div>
            
            <div class="user-info">
                <div class="user-avatar">
                    <span>CC</span>
                </div>
                <div>
                    <p style="font-weight: 600;">Candy Cami</p>
                    <p style="font-size: 0.9rem; color: #666;">Administrador</p>
                </div>
            </div>
        </div>
        
        <!-- Content Wrapper -->
        <div class="content-wrapper">
            <!-- Inventory Management Section -->
            <section id="inventorySection" class="content-section active">
                <h2 class="section-title">
                    <i class="fas fa-boxes"></i> Gestión de Inventario
                </h2>
                
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>¡Atención!</strong> Los productos marcados en rojo tienen inventario bajo. 
                        Los productos en verde tienen inventario suficiente.
                    </div>
                </div>
                
                <div class="product-form">
                    <h3><i class="fas fa-plus-circle"></i> Agregar Nuevo Producto</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productName">Nombre del Producto *</label>
                            <input type="text" id="productName" placeholder="Ej: Concentrado Michelada Tamarindo">
                        </div>
                        <div class="form-group">
                            <label for="productType">Tipo de Producto *</label>
                            <select id="productType">
                                <option value="concentrado">Concentrado de Michelada</option>
                                <option value="embolsado">Producto Embolsado</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productPrice">Precio de Venta ($) *</label>
                            <input type="number" id="productPrice" min="0" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label for="productCost">Costo ($) *</label>
                            <input type="number" id="productCost" min="0" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="initialStock">Inventario Inicial *</label>
                            <input type="number" id="initialStock" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="minStock">Inventario Mínimo (Alerta) *</label>
                            <input type="number" id="minStock" min="0" placeholder="10">
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="addProductBtn">
                        <i class="fas fa-save"></i> Guardar Producto
                    </button>
                </div>
                
                <h3 class="section-title">
                    <i class="fas fa-list"></i> Productos Registrados
                </h3>
                
                <table class="products-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Tipo</th>
                            <th>Precio</th>
                            <th>Costo</th>
                            <th>Inventario</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="productsTableBody">
                        <!-- Los productos se agregarán aquí dinámicamente -->
                    </tbody>
                </table>
                
                <div class="data-management">
                    <h3><i class="fas fa-database"></i> Gestión de Datos</h3>
                    <p>Los datos se guardan automáticamente en tu navegador. También puedes:</p>
                    <div class="data-buttons">
                        <button class="btn btn-success" id="exportDataBtn">
                            <i class="fas fa-file-export"></i> Exportar Datos
                        </button>
                        <button class="btn btn-warning" id="importDataBtn">
                            <i class="fas fa-file-import"></i> Importar Datos
                        </button>
                        <button class="btn btn-danger" id="resetDataBtn">
                            <i class="fas fa-trash"></i> Restablecer Datos
                        </button>
                    </div>
                    <input type="file" id="importFile" style="display: none;" accept=".json">
                </div>
            </section>
            
            <!-- Point of Sale Section -->
            <section id="posSection" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-cash-register"></i> Punto de Venta
                </h2>
                
                <div class="alert alert-success">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>Instrucciones:</strong> Haz clic en los productos para agregarlos a la venta. 
                        Puedes ajustar las cantidades en el carrito de la derecha.
                    </div>
                </div>
                
                <div class="pos-container">
                    <div class="products-grid" id="productsGrid">
                        <!-- Los productos para la venta se cargarán aquí -->
                    </div>
                    
                    <div class="sale-sidebar">
                        <h3><i class="fas fa-shopping-cart"></i> Carrito de Venta</h3>
                        
                        <div class="cart-items" id="cartItems">
                            <!-- Los productos del carrito aparecerán aquí -->
                            <p id="emptyCartMessage">El carrito está vacío. Selecciona productos para comenzar.</p>
                        </div>
                        
                        <div class="cart-total">
                            Total: $<span id="cartTotal">0.00</span>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button class="btn btn-success" id="completeSaleBtn" style="flex: 2;">
                                <i class="fas fa-check-circle"></i> Completar Venta
                            </button>
                            <button class="btn btn-warning" id="cancelSaleBtn" style="flex: 1;">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Reports Section -->
            <section id="reportsSection" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-chart-bar"></i> Reportes y Estadísticas
                </h2>
                
                <div class="alert alert-warning">
                    <i class="fas fa-chart-line"></i>
                    <div>
                        <strong>Reportes:</strong> Visualiza el desempeño de tus ventas y el estado de tu inventario.
                    </div>
                </div>
                
                <!-- Filtros de Reportes -->
                <div class="report-filters">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="reportDate">Fecha del Reporte</label>
                            <input type="date" id="reportDate" class="form-control">
                        </div>
                        <div class="filter-group">
                            <label for="reportType">Tipo de Producto</label>
                            <select id="reportType" class="form-control">
                                <option value="todos">Todos los productos</option>
                                <option value="concentrado">Concentrados</option>
                                <option value="embolsado">Embolsados</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="reportRange">Rango de Fechas</label>
                            <select id="reportRange" class="form-control">
                                <option value="hoy">Hoy</option>
                                <option value="ayer">Ayer</option>
                                <option value="semana">Esta semana</option>
                                <option value="mes">Este mes</option>
                                <option value="personalizado">Personalizado</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <button class="btn btn-primary" id="generateReportBtn">
                                <i class="fas fa-filter"></i> Filtrar Reporte
                            </button>
                            <button class="btn btn-info" id="exportReportBtn" style="margin-top: 5px;">
                                <i class="fas fa-file-excel"></i> Exportar a Excel
                            </button>
                        </div>
                    </div>
                    
                    <div class="filter-row" id="customRangeRow" style="display: none;">
                        <div class="filter-group">
                            <label for="startDate">Fecha Inicio</label>
                            <input type="date" id="startDate" class="form-control">
                        </div>
                        <div class="filter-group">
                            <label for="endDate">Fecha Fin</label>
                            <input type="date" id="endDate" class="form-control">
                        </div>
                    </div>
                </div>
                
                <!-- Pestañas de Reportes -->
                <div class="reports-tabs">
                    <button class="tab-btn active" data-tab="dailyReport">
                        <i class="fas fa-calendar-day"></i> Reporte Diario
                    </button>
                    <button class="tab-btn" data-tab="salesReport">
                        <i class="fas fa-shopping-cart"></i> Reporte de Ventas
                    </button>
                    <button class="tab-btn" data-tab="inventoryReport">
                        <i class="fas fa-boxes"></i> Reporte de Inventario
                    </button>
                    <button class="tab-btn" data-tab="productsReport">
                        <i class="fas fa-star"></i> Productos Más Vendidos
                    </button>
                </div>
                
                <!-- Tarjetas de Resumen -->
                <div class="report-summary-cards">
                    <div class="summary-card">
                        <h4>Ventas Hoy</h4>
                        <div class="value" id="salesTodayValue">$0.00</div>
                        <div class="subtext" id="salesTodayCount">0 ventas</div>
                    </div>
                    <div class="summary-card">
                        <h4>Productos Vendidos</h4>
                        <div class="value" id="productsSoldValue">0</div>
                        <div class="subtext" id="productsSoldType">0 concentrados, 0 embolsados</div>
                    </div>
                    <div class="summary-card">
                        <h4>Promedio por Venta</h4>
                        <div class="value" id="avgSaleValue">$0.00</div>
                        <div class="subtext">Por transacción</div>
                    </div>
                    <div class="summary-card">
                        <h4>Inventario Bajo</h4>
                        <div class="value" id="lowInventoryValue">0</div>
                        <div class="subtext">Productos por reabastecer</div>
                    </div>
                </div>
                
                <!-- Contenido de Reportes -->
                <div class="report-content active" id="dailyReport">
                    <h3 class="section-title">
                        <i class="fas fa-calendar-day"></i> Reporte Diario de Ventas
                    </h3>
                    
                    <div style="overflow-x: auto;">
                        <table class="products-table">
                            <thead>
                                <tr>
                                    <th>Hora</th>
                                    <th>ID Venta</th>
                                    <th>Productos</th>
                                    <th>Cantidad Total</th>
                                    <th>Total Venta</th>
                                    <th>Detalles</th>
                                </tr>
                            </thead>
                            <tbody id="dailyReportBody">
                                <!-- Ventas del día se cargarán aquí -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: var(--border-radius);">
                        <h4><i class="fas fa-chart-pie"></i> Resumen del Día</h4>
                        <div id="dailySummaryDetails"></div>
                    </div>
                </div>
                
                <div class="report-content" id="salesReport">
                    <h3 class="section-title">
                        <i class="fas fa-shopping-cart"></i> Reporte Histórico de Ventas
                    </h3>
                    
                    <div style="overflow-x: auto;">
                        <table class="products-table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>ID Venta</th>
                                    <th>Concentrados</th>
                                    <th>Embolsados</th>
                                    <th>Total Productos</th>
                                    <th>Total Venta</th>
                                    <th>Ver Detalle</th>
                                </tr>
                            </thead>
                            <tbody id="salesReportBody">
                                <!-- Ventas históricas se cargarán aquí -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-primary" id="loadMoreSalesBtn">
                            <i class="fas fa-plus"></i> Cargar Más Ventas
                        </button>
                    </div>
                </div>
                
                <div class="report-content" id="inventoryReport">
                    <h3 class="section-title">
                        <i class="fas fa-boxes"></i> Reporte de Estado de Inventario
                    </h3>
                    
                    <div style="overflow-x: auto;">
                        <table class="products-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Producto</th>
                                    <th>Tipo</th>
                                    <th>Stock Actual</th>
                                    <th>Stock Mínimo</th>
                                    <th>Estado</th>
                                    <th>Valor en Inventario</th>
                                    <th>Último Movimiento</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryReportBody">
                                <!-- Inventario se cargará aquí -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: var(--border-radius);">
                        <h4><i class="fas fa-calculator"></i> Resumen de Inventario</h4>
                        <div id="inventorySummaryDetails"></div>
                    </div>
                </div>
                
                <div class="report-content" id="productsReport">
                    <h3 class="section-title">
                        <i class="fas fa-star"></i> Productos Más Vendidos
                    </h3>
                    
                    <div style="overflow-x: auto;">
                        <table class="products-table">
                            <thead>
                                <tr>
                                    <th>Posición</th>
                                    <th>Producto</th>
                                    <th>Tipo</th>
                                    <th>Unidades Vendidas</th>
                                    <th>Total en Ventas</th>
                                    <th>% del Total</th>
                                    <th>Stock Actual</th>
                                    <th>Rendimiento</th>
                                </tr>
                            </thead>
                            <tbody id="productsReportBody">
                                <!-- Productos más vendidos se cargarán aquí -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: var(--border-radius);">
                        <h4><i class="fas fa-trophy"></i> Top 5 Productos</h4>
                        <div id="topProductsChart"></div>
                    </div>
                </div>
            </section>
            
            <!-- Dashboard Section -->
            <section id="dashboardSection" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </h2>
                
                <div class="alert alert-success">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>Bienvenido al Dashboard:</strong> Visualiza el resumen general de tu negocio.
                    </div>
                </div>
                
                <div class="report-summary-cards">
                    <div class="summary-card" style="border-top-color: var(--primary-color);">
                        <h4>Ventas Totales</h4>
                        <div class="value" id="dashboardTotalSales">$0.00</div>
                        <div class="subtext">Histórico completo</div>
                    </div>
                    <div class="summary-card" style="border-top-color: var(--success-color);">
                        <h4>Productos en Stock</h4>
                        <div class="value" id="dashboardTotalProducts">0</div>
                        <div class="subtext" id="dashboardProductTypes">0 concentrados, 0 embolsados</div>
                    </div>
                    <div class="summary-card" style="border-top-color: var(--info-color);">
                        <h4>Ventas del Mes</h4>
                        <div class="value" id="dashboardMonthlySales">$0.00</div>
                        <div class="subtext">Este mes</div>
                    </div>
                    <div class="summary-card" style="border-top-color: var(--warning-color);">
                        <h4>Productos Bajo Stock</h4>
                        <div class="value" id="dashboardLowStock">0</div>
                        <div class="subtext">Necesitan reabastecimiento</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 20px; margin-top: 30px;">
                    <div style="background-color: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                        <h3><i class="fas fa-chart-line"></i> Ventas Recientes</h3>
                        <div id="recentSalesList" style="margin-top: 15px; max-height: 300px; overflow-y: auto;">
                            <!-- Ventas recientes se cargarán aquí -->
                        </div>
                    </div>
                    
                    <div style="background-color: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                        <h3><i class="fas fa-exclamation-triangle"></i> Productos por Agotarse</h3>
                        <div id="lowStockProducts" style="margin-top: 15px; max-height: 300px; overflow-y: auto;">
                            <!-- Productos bajos en stock se cargarán aquí -->
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; background-color: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                    <h3><i class="fas fa-trophy"></i> Top Productos del Mes</h3>
                    <div id="monthlyTopProducts" style="margin-top: 15px;">
                        <!-- Top productos del mes se cargarán aquí -->
                    </div>
                </div>
            </section>
            
            <!-- Settings Section -->
            <section id="settingsSection" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-cog"></i> Configuración
                </h2>
                
                <div class="alert alert-warning">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>Configuración del Sistema:</strong> Personaliza la aplicación según tus necesidades.
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background-color: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                        <h3><i class="fas fa-store"></i> Información del Negocio</h3>
                        <div class="form-group" style="margin-top: 15px;">
                            <label for="businessName">Nombre del Negocio</label>
                            <input type="text" id="businessName" class="form-control" placeholder="Candy Cami">
                        </div>
                        <div class="form-group">
                            <label for="businessAddress">Dirección</label>
                            <input type="text" id="businessAddress" class="form-control" placeholder="Dirección del negocio">
                        </div>
                        <div class="form-group">
                            <label for="businessPhone">Teléfono</label>
                            <input type="text" id="businessPhone" class="form-control" placeholder="Teléfono de contacto">
                        </div>
                        <button class="btn btn-primary" id="saveBusinessInfoBtn" style="width: 100%; margin-top: 15px;">
                            <i class="fas fa-save"></i> Guardar Información
                        </button>
                    </div>
                    
                    <div style="background-color: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                        <h3><i class="fas fa-receipt"></i> Configuración de Ventas</h3>
                        <div class="form-group" style="margin-top: 15px;">
                            <label for="taxRate">Tasa de Impuesto (%)</label>
                            <input type="number" id="taxRate" class="form-control" min="0" max="100" step="0.1" value="16">
                        </div>
                        <div class="form-group">
                            <label for="currencySymbol">Símbolo de Moneda</label>
                            <input type="text" id="currencySymbol" class="form-control" value="$" maxlength="3">
                        </div>
                        <div class="form-group">
                            <label for="receiptFooter">Pie de Página en Tickets</label>
                            <textarea id="receiptFooter" class="form-control" rows="3" placeholder="Gracias por su compra..."></textarea>
                        </div>
                        <button class="btn btn-primary" id="saveSalesSettingsBtn" style="width: 100%; margin-top: 15px;">
                            <i class="fas fa-save"></i> Guardar Configuración
                        </button>
                    </div>
                    
                    <div style="background-color: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                        <h3><i class="fas fa-palette"></i> Apariencia</h3>
                        <div class="form-group" style="margin-top: 15px;">
                            <label for="themeColor">Color del Tema</label>
                            <select id="themeColor" class="form-control">
                                <option value="default">Default (Rosa/Morado)</option>
                                <option value="blue">Azul</option>
                                <option value="green">Verde</option>
                                <option value="red">Rojo</option>
                                <option value="orange">Naranja</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="language">Idioma</label>
                            <select id="language" class="form-control">
                                <option value="es">Español</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="darkMode"> Modo Oscuro
                            </label>
                        </div>
                        <button class="btn btn-primary" id="saveAppearanceBtn" style="width: 100%; margin-top: 15px;">
                            <i class="fas fa-save"></i> Guardar Apariencia
                        </button>
                    </div>
                </div>
                
                <div class="data-management" style="margin-top: 30px;">
                    <h3><i class="fas fa-database"></i> Gestión de Datos</h3>
                    <p>Administra los datos de la aplicación:</p>
                    <div class="data-buttons">
                        <button class="btn btn-success" id="exportAllDataBtn">
                            <i class="fas fa-file-export"></i> Exportar Todos los Datos
                        </button>
                        <button class="btn btn-warning" id="importSettingsBtn">
                            <i class="fas fa-file-import"></i> Importar Configuración
                        </button>
                        <button class="btn btn-danger" id="clearAllDataBtn">
                            <i class="fas fa-trash"></i> Limpiar Todos los Datos
                        </button>
                    </div>
                    <div style="margin-top: 15px;">
                        <p><strong>Espacio utilizado:</strong> <span id="storageUsed">0 KB</span></p>
                        <div style="height: 10px; background-color: #e9ecef; border-radius: 5px; overflow: hidden; margin-top: 5px;">
                            <div id="storageBar" style="height: 100%; width: 0%; background-color: var(--primary-color);"></div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal para ajustar inventario -->
    <div id="adjustStockModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Ajustar Inventario</h3>
                <button class="close-modal" id="closeStockModal">&times;</button>
            </div>
            <div id="modalBody">
                <!-- Contenido dinámico -->
            </div>
        </div>
    </div>

    <!-- Modal para detalles de venta -->
    <div id="saleDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Detalles de Venta #<span id="saleDetailId"></span></h3>
                <button class="close-modal" id="closeSaleDetailModal">&times;</button>
            </div>
            <div id="saleDetailBody">
                <!-- Contenido dinámico -->
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let products = [];
        let cart = [];
        let sales = [];
        let stockMovements = [];
        let nextProductId = 1;
        let nextSaleId = 1;
        let nextMovementId = 1;
        let currentSalesPage = 1;
        const SALES_PER_PAGE = 20;
        let sidebarCollapsed = false;

        // Configuración del sistema
        let settings = {
            businessName: "Candy Cami",
            businessAddress: "",
            businessPhone: "",
            taxRate: 16,
            currencySymbol: "$",
            receiptFooter: "¡Gracias por su compra! Vuelva pronto.",
            themeColor: "default",
            language: "es",
            darkMode: false
        };

        // Claves para localStorage
        const STORAGE_KEYS = {
            PRODUCTS: 'candy_cami_products',
            SALES: 'candy_cami_sales',
            MOVEMENTS: 'candy_cami_movements',
            NEXT_IDS: 'candy_cami_next_ids',
            SETTINGS: 'candy_cami_settings'
        };

        // Elementos del DOM
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const toggleIcon = document.getElementById('toggleIcon');
        const menuItems = document.querySelectorAll('.menu-item');
        const pageTitle = document.getElementById('pageTitle');
        const contentSections = document.querySelectorAll('.content-section');
        const productsTableBody = document.getElementById('productsTableBody');
        const productsGrid = document.getElementById('productsGrid');
        const cartItems = document.getElementById('cartItems');
        const cartTotal = document.getElementById('cartTotal');
        const emptyCartMessage = document.getElementById('emptyCartMessage');
        const addProductBtn = document.getElementById('addProductBtn');
        const completeSaleBtn = document.getElementById('completeSaleBtn');
        const cancelSaleBtn = document.getElementById('cancelSaleBtn');
        const adjustStockModal = document.getElementById('adjustStockModal');
        const closeStockModal = document.getElementById('closeStockModal');
        const exportDataBtn = document.getElementById('exportDataBtn');
        const importDataBtn = document.getElementById('importDataBtn');
        const importFileInput = document.getElementById('importFile');
        const resetDataBtn = document.getElementById('resetDataBtn');
        const reportDateInput = document.getElementById('reportDate');
        const reportTypeSelect = document.getElementById('reportType');
        const reportRangeSelect = document.getElementById('reportRange');
        const generateReportBtn = document.getElementById('generateReportBtn');
        const exportReportBtn = document.getElementById('exportReportBtn');
        const customRangeRow = document.getElementById('customRangeRow');
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const saleDetailModal = document.getElementById('saleDetailModal');
        const closeSaleDetailModal = document.getElementById('closeSaleDetailModal');
        const tabButtons = document.querySelectorAll('.tab-btn');
        const loadMoreSalesBtn = document.getElementById('loadMoreSalesBtn');
        const saveBusinessInfoBtn = document.getElementById('saveBusinessInfoBtn');
        const saveSalesSettingsBtn = document.getElementById('saveSalesSettingsBtn');
        const saveAppearanceBtn = document.getElementById('saveAppearanceBtn');
        const exportAllDataBtn = document.getElementById('exportAllDataBtn');
        const importSettingsBtn = document.getElementById('importSettingsBtn');
        const clearAllDataBtn = document.getElementById('clearAllDataBtn');
        const storageUsed = document.getElementById('storageUsed');
        const storageBar = document.getElementById('storageBar');

        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', () => {
            // Establecer fecha actual como predeterminada
            const today = new Date().toISOString().split('T')[0];
            reportDateInput.value = today;
            startDateInput.value = today;
            endDateInput.value = today;
            
            loadData();
            loadSettings();
            setupEventListeners();
            loadProductsTable();
            updateCartDisplay();
            
            // Calcular espacio de almacenamiento
            updateStorageInfo();
            
            // Cargar reporte inicial
            setTimeout(() => loadReports(), 100);
        });

        // Configurar todos los event listeners
        function setupEventListeners() {
            // Sidebar toggle
            sidebarToggle.addEventListener('click', toggleSidebar);
            
            // Navegación del menú
            menuItems.forEach(item => {
                item.addEventListener('click', () => {
                    const section = item.getAttribute('data-section');
                    switchSection(section);
                });
            });

            // Botones de productos
            addProductBtn.addEventListener('click', addProduct);
            completeSaleBtn.addEventListener('click', completeSale);
            cancelSaleBtn.addEventListener('click', cancelSale);

            // Modales
            closeStockModal.addEventListener('click', () => {
                adjustStockModal.classList.remove('active');
            });
            
            closeSaleDetailModal.addEventListener('click', () => {
                saleDetailModal.classList.remove('active');
            });

            // Gestión de datos
            exportDataBtn.addEventListener('click', exportData);
            importDataBtn.addEventListener('click', () => importFileInput.click());
            importFileInput.addEventListener('change', importData);
            resetDataBtn.addEventListener('click', resetData);

            // Reportes
            generateReportBtn.addEventListener('click', loadReports);
            exportReportBtn.addEventListener('click', exportReportToExcel);
            reportRangeSelect.addEventListener('change', toggleCustomRange);
            
            // Pestañas de reportes
            tabButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.getAttribute('data-tab');
                    switchReportTab(tabId);
                });
            });
            
            // Botón cargar más ventas
            loadMoreSalesBtn.addEventListener('click', loadMoreSales);
            
            // Configuración
            saveBusinessInfoBtn.addEventListener('click', saveBusinessInfo);
            saveSalesSettingsBtn.addEventListener('click', saveSalesSettings);
            saveAppearanceBtn.addEventListener('click', saveAppearance);
            exportAllDataBtn.addEventListener('click', exportAllData);
            importSettingsBtn.addEventListener('click', () => {
                importFileInput.click();
                importFileInput.onchange = importSettings;
            });
            clearAllDataBtn.addEventListener('click', clearAllData);

            // Cerrar modales al hacer clic fuera
            window.addEventListener('click', (e) => {
                if (e.target === adjustStockModal) {
                    adjustStockModal.classList.remove('active');
                }
                if (e.target === saleDetailModal) {
                    saleDetailModal.classList.remove('active');
                }
            });
        }

        // Alternar sidebar
        function toggleSidebar() {
            sidebarCollapsed = !sidebarCollapsed;
            
            if (sidebarCollapsed) {
                sidebar.classList.add('collapsed');
                mainContent.classList.add('collapsed');
                toggleIcon.classList.remove('fa-chevron-left');
                toggleIcon.classList.add('fa-chevron-right');
            } else {
                sidebar.classList.remove('collapsed');
                mainContent.classList.remove('collapsed');
                toggleIcon.classList.remove('fa-chevron-right');
                toggleIcon.classList.add('fa-chevron-left');
            }
        }

        // Mostrar/ocultar rango personalizado de fechas
        function toggleCustomRange() {
            if (reportRangeSelect.value === 'personalizado') {
                customRangeRow.style.display = 'flex';
            } else {
                customRangeRow.style.display = 'none';
            }
        }

        // Cambiar sección
        function switchSection(section) {
            // Remover clase active de todos los items del menú
            menuItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Remover clase active de todas las secciones
            contentSections.forEach(sec => {
                sec.classList.remove('active');
            });
            
            // Agregar clase active al item del menú seleccionado
            document.querySelector(`[data-section="${section}"]`).classList.add('active');
            
            // Mostrar la sección correspondiente
            const sectionElement = document.getElementById(`${section}Section`);
            if (sectionElement) {
                sectionElement.classList.add('active');
                
                // Actualizar título de la página
                updatePageTitle(section);
                
                // Cargar datos específicos de la sección
                if (section === 'inventory') {
                    loadProductsTable();
                } else if (section === 'pos') {
                    loadProductsForSale();
                } else if (section === 'reports') {
                    loadReports();
                } else if (section === 'dashboard') {
                    loadDashboard();
                } else if (section === 'settings') {
                    loadSettingsForm();
                }
            }
        }

        // Actualizar título de la página
        function updatePageTitle(section) {
            const titles = {
                'inventory': { icon: 'fa-boxes', text: 'Gestión de Inventario' },
                'pos': { icon: 'fa-cash-register', text: 'Punto de Venta' },
                'reports': { icon: 'fa-chart-bar', text: 'Reportes y Estadísticas' },
                'dashboard': { icon: 'fa-tachometer-alt', text: 'Dashboard' },
                'settings': { icon: 'fa-cog', text: 'Configuración' }
            };
            
            if (titles[section]) {
                pageTitle.innerHTML = `
                    <i class="fas ${titles[section].icon}"></i>
                    <span>${titles[section].text}</span>
                `;
            }
        }

        // Cambiar pestaña de reportes
        function switchReportTab(tabId) {
            // Remover clase active de todos los botones y contenidos
            tabButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.report-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Agregar clase active al botón y contenido seleccionado
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // Cargar datos desde localStorage
        function loadData() {
            try {
                // Cargar productos
                const savedProducts = localStorage.getItem(STORAGE_KEYS.PRODUCTS);
                if (savedProducts) {
                    products = JSON.parse(savedProducts);
                } else {
                    // Datos de ejemplo si no hay nada guardado
                    products = [
                        { id: 1, name: "Concentrado Michelada Clásica", type: "concentrado", price: 25.00, cost: 12.50, stock: 15, minStock: 10 },
                        { id: 2, name: "Concentrado Michelada Tamarindo", type: "concentrado", price: 28.00, cost: 14.00, stock: 8, minStock: 10 },
                        { id: 3, name: "Concentrado Michelada Mango", type: "concentrado", price: 28.00, cost: 14.00, stock: 12, minStock: 10 },
                        { id: 4, name: "Cacahuates Japoneses", type: "embolsado", price: 15.00, cost: 8.00, stock: 25, minStock: 15 },
                        { id: 5, name: "Gomitas de Sandía", type: "embolsado", price: 12.00, cost: 6.00, stock: 30, minStock: 15 },
                        { id: 6, name: "Papas Sabritas", type: "embolsado", price: 18.00, cost: 9.00, stock: 10, minStock: 15 }
                    ];
                }

                // Cargar ventas
                const savedSales = localStorage.getItem(STORAGE_KEYS.SALES);
                if (savedSales) {
                    sales = JSON.parse(savedSales);
                }

                // Cargar movimientos
                const savedMovements = localStorage.getItem(STORAGE_KEYS.MOVEMENTS);
                if (savedMovements) {
                    stockMovements = JSON.parse(savedMovements);
                }

                // Cargar IDs siguientes
                const savedIds = localStorage.getItem(STORAGE_KEYS.NEXT_IDS);
                if (savedIds) {
                    const ids = JSON.parse(savedIds);
                    nextProductId = ids.nextProductId || Math.max(...products.map(p => p.id), 0) + 1;
                    nextSaleId = ids.nextSaleId || 1;
                    nextMovementId = ids.nextMovementId || 1;
                } else {
                    nextProductId = Math.max(...products.map(p => p.id), 0) + 1;
                    nextSaleId = 1;
                    nextMovementId = 1;
                }

                console.log('Datos cargados correctamente');
            } catch (error) {
                console.error('Error cargando datos:', error);
                alert('Error al cargar los datos. Se usarán datos de ejemplo.');
                
                // Usar datos de ejemplo en caso de error
                products = [
                    { id: 1, name: "Concentrado Michelada Clásica", type: "concentrado", price: 25.00, cost: 12.50, stock: 15, minStock: 10 },
                    { id: 2, name: "Concentrado Michelada Tamarindo", type: "concentrado", price: 28.00, cost: 14.00, stock: 8, minStock: 10 },
                    { id: 3, name: "Concentrado Michelada Mango", type: "concentrado", price: 28.00, cost: 14.00, stock: 12, minStock: 10 },
                    { id: 4, name: "Cacahuates Japoneses", type: "embolsado", price: 15.00, cost: 8.00, stock: 25, minStock: 15 },
                    { id: 5, name: "Gomitas de Sandía", type: "embolsado", price: 12.00, cost: 6.00, stock: 30, minStock: 15 },
                    { id: 6, name: "Papas Sabritas", type: "embolsado", price: 18.00, cost: 9.00, stock: 10, minStock: 15 }
                ];
                sales = [];
                stockMovements = [];
                nextProductId = 7;
                nextSaleId = 1;
                nextMovementId = 1;
            }
        }

        // Cargar configuración
        function loadSettings() {
            try {
                const savedSettings = localStorage.getItem(STORAGE_KEYS.SETTINGS);
                if (savedSettings) {
                    settings = JSON.parse(savedSettings);
                }
            } catch (error) {
                console.error('Error cargando configuración:', error);
            }
        }

        // Guardar configuración
        function saveSettings() {
            try {
                localStorage.setItem(STORAGE_KEYS.SETTINGS, JSON.stringify(settings));
            } catch (error) {
                console.error('Error guardando configuración:', error);
            }
        }

        // Cargar formulario de configuración
        function loadSettingsForm() {
            document.getElementById('businessName').value = settings.businessName;
            document.getElementById('businessAddress').value = settings.businessAddress;
            document.getElementById('businessPhone').value = settings.businessPhone;
            document.getElementById('taxRate').value = settings.taxRate;
            document.getElementById('currencySymbol').value = settings.currencySymbol;
            document.getElementById('receiptFooter').value = settings.receiptFooter;
            document.getElementById('themeColor').value = settings.themeColor;
            document.getElementById('language').value = settings.language;
            document.getElementById('darkMode').checked = settings.darkMode;
            
            updateStorageInfo();
        }

        // Guardar datos en localStorage
        function saveData() {
            try {
                localStorage.setItem(STORAGE_KEYS.PRODUCTS, JSON.stringify(products));
                localStorage.setItem(STORAGE_KEYS.SALES, JSON.stringify(sales));
                localStorage.setItem(STORAGE_KEYS.MOVEMENTS, JSON.stringify(stockMovements));
                
                const ids = {
                    nextProductId: nextProductId,
                    nextSaleId: nextSaleId,
                    nextMovementId: nextMovementId
                };
                localStorage.setItem(STORAGE_KEYS.NEXT_IDS, JSON.stringify(ids));
                
                console.log('Datos guardados correctamente');
                updateStorageInfo();
            } catch (error) {
                console.error('Error guardando datos:', error);
                alert('Error al guardar los datos. Verifica que tienes suficiente espacio de almacenamiento.');
            }
        }

        // Actualizar información de almacenamiento
        function updateStorageInfo() {
            let totalSize = 0;
            
            // Calcular tamaño de todos los datos en localStorage
            for (let key in STORAGE_KEYS) {
                const data = localStorage.getItem(STORAGE_KEYS[key]);
                if (data) {
                    totalSize += new Blob([data]).size;
                }
            }
            
            // Convertir a KB
            const sizeInKB = (totalSize / 1024).toFixed(2);
            storageUsed.textContent = `${sizeInKB} KB`;
            
            // Calcular porcentaje (asumiendo 5MB máximo)
            const maxStorage = 5 * 1024; // 5MB en KB
            const percentage = (totalSize / (maxStorage * 1024)) * 100;
            storageBar.style.width = `${Math.min(percentage, 100)}%`;
            
            // Cambiar color según el uso
            if (percentage > 80) {
                storageBar.style.backgroundColor = 'var(--danger-color)';
            } else if (percentage > 60) {
                storageBar.style.backgroundColor = 'var(--warning-color)';
            } else {
                storageBar.style.backgroundColor = 'var(--primary-color)';
            }
        }

        // Cargar productos en la tabla de inventario
        function loadProductsTable() {
            if (!products.length) {
                productsTableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px;">
                            <i class="fas fa-box-open" style="font-size: 3rem; color: #ddd; margin-bottom: 15px;"></i>
                            <p>No hay productos registrados. Agrega tu primer producto.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            productsTableBody.innerHTML = '';
            
            products.forEach(product => {
                const statusClass = product.stock <= product.minStock ? 'inventory-low' : 'inventory-ok';
                const statusText = product.stock <= product.minStock ? 'BAJO' : 'OK';
                const badgeClass = product.type === 'concentrado' ? 'badge-concentrado' : 'badge-embolsado';
                const badgeText = product.type === 'concentrado' ? 'Concentrado' : 'Embolsado';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td><span class="badge ${badgeClass}">${badgeText}</span></td>
                    <td>${settings.currencySymbol}${parseFloat(product.price).toFixed(2)}</td>
                    <td>${settings.currencySymbol}${parseFloat(product.cost).toFixed(2)}</td>
                    <td class="${statusClass}">${product.stock}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-warning" onclick="editProduct(${product.id})" style="padding: 5px 10px; font-size: 0.9rem;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-primary" onclick="adjustStockModalOpen(${product.id})" style="padding: 5px 10px; font-size: 0.9rem;">
                            <i class="fas fa-box"></i>
                        </button>
                        <button class="btn btn-danger" onclick="deleteProduct(${product.id})" style="padding: 5px 10px; font-size: 0.9rem;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                productsTableBody.appendChild(row);
            });
        }

        // Cargar productos para la venta
        function loadProductsForSale() {
            productsGrid.innerHTML = '';
            
            if (!products.length) {
                productsGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; color: #ddd; margin-bottom: 15px;"></i>
                        <p>No hay productos disponibles para la venta.</p>
                    </div>
                `;
                return;
            }
            
            products.forEach(product => {
                if (product.stock > 0) {
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.dataset.id = product.id;
                    
                    const statusClass = product.stock <= product.minStock ? 'inventory-low' : 'inventory-ok';
                    const badgeClass = product.type === 'concentrado' ? 'badge-concentrado' : 'badge-embolsado';
                    const badgeText = product.type === 'concentrado' ? 'Concentrado' : 'Embolsado';
                    
                    card.innerHTML = `
                        <h4>${product.name}</h4>
                        <div class="price">${settings.currencySymbol}${parseFloat(product.price).toFixed(2)}</div>
                        <div class="inventory ${statusClass}">Disponible: ${product.stock}</div>
                        <div style="margin-top: 10px;">
                            <span class="badge ${badgeClass}">${badgeText}</span>
                        </div>
                    `;
                    
                    card.addEventListener('click', () => addToCart(product.id));
                    productsGrid.appendChild(card);
                }
            });
        }

        // Agregar producto al carrito
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const existingItem = cart.find(item => item.productId === productId);
            
            if (existingItem) {
                if (existingItem.quantity < product.stock) {
                    existingItem.quantity++;
                } else {
                    alert(`No hay suficiente inventario de ${product.name}. Solo quedan ${product.stock} unidades.`);
                    return;
                }
            } else {
                if (product.stock > 0) {
                    cart.push({
                        productId: product.id,
                        name: product.name,
                        price: product.price,
                        quantity: 1
                    });
                } else {
                    alert(`No hay inventario disponible de ${product.name}.`);
                    return;
                }
            }
            
            updateCartDisplay();
        }

        // Actualizar la visualización del carrito
        function updateCartDisplay() {
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p id="emptyCartMessage">El carrito está vacío. Selecciona productos para comenzar.</p>';
                cartTotal.textContent = '0.00';
                return;
            }
            
            let total = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div><strong>${item.name}</strong></div>
                        <div>${settings.currencySymbol}${parseFloat(item.price).toFixed(2)} c/u</div>
                    </div>
                    <div class="cart-item-quantity">
                        <button onclick="decreaseQuantity(${item.productId})">-</button>
                        <span>${item.quantity}</span>
                        <button onclick="increaseQuantity(${item.productId})">+</button>
                    </div>
                    <div style="font-weight: bold; min-width: 80px; text-align: right;">
                        ${settings.currencySymbol}${itemTotal.toFixed(2)}
                    </div>
                `;
                
                cartItems.appendChild(cartItem);
            });
            
            // Calcular impuestos si están configurados
            let finalTotal = total;
            if (settings.taxRate > 0) {
                const taxAmount = total * (settings.taxRate / 100);
                finalTotal = total + taxAmount;
                
                const taxRow = document.createElement('div');
                taxRow.className = 'cart-item';
                taxRow.innerHTML = `
                    <div class="cart-item-info">
                        <div><strong>Impuesto (${settings.taxRate}%)</strong></div>
                    </div>
                    <div style="font-weight: bold; min-width: 80px; text-align: right;">
                        ${settings.currencySymbol}${taxAmount.toFixed(2)}
                    </div>
                `;
                cartItems.appendChild(taxRow);
            }
            
            cartTotal.textContent = finalTotal.toFixed(2);
        }

        // Aumentar cantidad de un producto en el carrito
        function increaseQuantity(productId) {
            const item = cart.find(item => item.productId === productId);
            const product = products.find(p => p.id === productId);
            
            if (item && product) {
                if (item.quantity < product.stock) {
                    item.quantity++;
                    updateCartDisplay();
                } else {
                    alert(`No hay suficiente inventario de ${product.name}. Solo quedan ${product.stock} unidades.`);
                }
            }
        }

        // Disminuir cantidad de un producto en el carrito
        function decreaseQuantity(productId) {
            const itemIndex = cart.findIndex(item => item.productId === productId);
            
            if (itemIndex !== -1) {
                if (cart[itemIndex].quantity > 1) {
                    cart[itemIndex].quantity--;
                } else {
                    cart.splice(itemIndex, 1);
                }
                
                updateCartDisplay();
            }
        }

        // Agregar nuevo producto
        function addProduct() {
            const name = document.getElementById('productName').value.trim();
            const type = document.getElementById('productType').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const cost = parseFloat(document.getElementById('productCost').value);
            const stock = parseInt(document.getElementById('initialStock').value);
            const minStock = parseInt(document.getElementById('minStock').value);
            
            // Validaciones
            if (!name) {
                alert('Por favor ingresa un nombre para el producto.');
                return;
            }
            
            if (isNaN(price) || price <= 0) {
                alert('Por favor ingresa un precio válido mayor a 0.');
                return;
            }
            
            if (isNaN(cost) || cost < 0) {
                alert('Por favor ingresa un costo válido.');
                return;
            }
            
            if (isNaN(stock) || stock < 0) {
                alert('Por favor ingresa un inventario inicial válido.');
                return;
            }
            
            if (isNaN(minStock) || minStock < 0) {
                alert('Por favor ingresa un inventario mínimo válido.');
                return;
            }
            
            // Crear nuevo producto
            const newProduct = {
                id: nextProductId++,
                name,
                type,
                price,
                cost,
                stock,
                minStock
            };
            
            products.push(newProduct);
            
            // Registrar movimiento de stock inicial
            const movement = {
                id: nextMovementId++,
                productId: newProduct.id,
                productName: newProduct.name,
                type: 'entrada',
                quantity: stock,
                previousStock: 0,
                newStock: stock,
                notes: 'Inventario inicial',
                date: new Date().toISOString()
            };
            
            stockMovements.push(movement);
            
            // Limpiar formulario
            document.getElementById('productName').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productCost').value = '';
            document.getElementById('initialStock').value = '';
            document.getElementById('minStock').value = '10';
            
            // Guardar datos
            saveData();
            
            // Actualizar tabla
            loadProductsTable();
            
            alert(`Producto "${name}" agregado exitosamente.`);
        }

        // Completar venta
        function completeSale() {
            if (cart.length === 0) {
                alert('El carrito está vacío. Agrega productos para completar la venta.');
                return;
            }
            
            // Verificar que haya suficiente inventario para todos los productos
            for (const item of cart) {
                const product = products.find(p => p.id === item.productId);
                if (product.stock < item.quantity) {
                    alert(`No hay suficiente inventario de ${product.name}. Solo quedan ${product.stock} unidades.`);
                    return;
                }
            }
            
            // Actualizar inventario y preparar detalles de venta
            let saleTotal = 0;
            const saleDetails = [];
            const today = new Date();
            
            for (const item of cart) {
                const productIndex = products.findIndex(p => p.id === item.productId);
                const product = products[productIndex];
                const previousStock = product.stock;
                
                // Actualizar stock
                product.stock -= item.quantity;
                
                // Calcular subtotal
                const subtotal = item.price * item.quantity;
                saleTotal += subtotal;
                
                // Agregar a detalles de venta
                saleDetails.push({
                    productId: item.productId,
                    name: item.name,
                    quantity: item.quantity,
                    price: item.price,
                    subtotal: subtotal
                });
                
                // Registrar movimiento de stock
                const movement = {
                    id: nextMovementId++,
                    productId: item.productId,
                    productName: item.name,
                    type: 'venta',
                    quantity: item.quantity,
                    previousStock: previousStock,
                    newStock: product.stock,
                    notes: `Venta #${nextSaleId}`,
                    date: today.toISOString()
                };
                
                stockMovements.push(movement);
            }
            
            // Calcular impuestos
            let finalTotal = saleTotal;
            if (settings.taxRate > 0) {
                finalTotal = saleTotal + (saleTotal * (settings.taxRate / 100));
            }
            
            // Registrar la venta
            const sale = {
                id: nextSaleId++,
                date: today.toISOString(),
                total: finalTotal,
                subtotal: saleTotal,
                taxAmount: settings.taxRate > 0 ? saleTotal * (settings.taxRate / 100) : 0,
                taxRate: settings.taxRate,
                details: saleDetails
            };
            
            sales.push(sale);
            
            // Guardar datos
            saveData();
            
            // Mostrar confirmación
            alert(`Venta completada exitosamente!\nTotal: ${settings.currencySymbol}${finalTotal.toFixed(2)}\nNúmero de venta: ${sale.id}`);
            
            // Limpiar carrito
            cart = [];
            updateCartDisplay();
            
            // Actualizar las vistas
            loadProductsTable();
            loadProductsForSale();
        }

        // Cancelar venta
        function cancelSale() {
            if (cart.length === 0) {
                alert('El carrito ya está vacío.');
                return;
            }
            
            if (confirm('¿Estás seguro de que deseas cancelar esta venta? Se eliminarán todos los productos del carrito.')) {
                cart = [];
                updateCartDisplay();
            }
        }

        // Editar producto
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const newName = prompt('Nuevo nombre del producto:', product.name);
            if (newName === null) return;
            
            const trimmedName = newName.trim();
            if (!trimmedName) {
                alert('El nombre no puede estar vacío.');
                return;
            }
            
            product.name = trimmedName;
            
            // Guardar datos
            saveData();
            
            // Actualizar vistas
            loadProductsTable();
            loadProductsForSale();
            
            alert('Producto actualizado exitosamente.');
        }

        // Eliminar producto
        function deleteProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            if (product.stock > 0) {
                if (!confirm(`El producto "${product.name}" tiene ${product.stock} unidades en inventario. ¿Estás seguro de que deseas eliminarlo?`)) {
                    return;
                }
            } else {
                if (!confirm(`¿Estás seguro de que deseas eliminar el producto "${product.name}"?`)) {
                    return;
                }
            }
            
            // Eliminar producto
            const productIndex = products.findIndex(p => p.id === productId);
            products.splice(productIndex, 1);
            
            // Guardar datos
            saveData();
            
            // Actualizar vistas
            loadProductsTable();
            loadProductsForSale();
            
            alert('Producto eliminado exitosamente.');
        }

        // Abrir modal para ajustar stock
        function adjustStockModalOpen(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            document.getElementById('modalBody').innerHTML = `
                <p><strong>Producto:</strong> ${product.name}</p>
                <p><strong>Stock actual:</strong> ${product.stock} unidades</p>
                <p><strong>Stock mínimo:</strong> ${product.minStock} unidades</p>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="adjustmentType">Tipo de ajuste</label>
                    <select id="adjustmentType" class="form-control">
                        <option value="entrada">Entrada (Aumentar stock)</option>
                        <option value="salida">Salida (Disminuir stock)</option>
                        <option value="ajuste">Ajuste manual</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="adjustmentQuantity">Cantidad</label>
                    <input type="number" id="adjustmentQuantity" class="form-control" min="1" value="1">
                </div>
                
                <div class="form-group">
                    <label for="adjustmentNotes">Notas (opcional)</label>
                    <textarea id="adjustmentNotes" class="form-control" rows="3" placeholder="Motivo del ajuste..."></textarea>
                </div>
                
                <button class="btn btn-success" id="saveAdjustmentBtn" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-save"></i> Guardar Ajuste
                </button>
            `;
            
            // Agregar event listener al botón de guardar
            setTimeout(() => {
                document.getElementById('saveAdjustmentBtn').addEventListener('click', () => adjustStock(productId));
            }, 100);
            
            adjustStockModal.classList.add('active');
        }

        // Ajustar stock de producto
        function adjustStock(productId) {
            const adjustmentType = document.getElementById('adjustmentType').value;
            const quantity = parseInt(document.getElementById('adjustmentQuantity').value);
            const notes = document.getElementById('adjustmentNotes').value.trim();
            
            if (isNaN(quantity) || quantity <= 0) {
                alert('Por favor ingresa una cantidad válida mayor a 0.');
                return;
            }
            
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const previousStock = product.stock;
            let newStock = product.stock;
            let movementQuantity = quantity;
            
            if (adjustmentType === 'entrada') {
                newStock = product.stock + quantity;
            } else if (adjustmentType === 'salida') {
                if (quantity > product.stock) {
                    alert(`No puedes retirar ${quantity} unidades. Solo hay ${product.stock} disponibles.`);
                    return;
                }
                newStock = product.stock - quantity;
            } else if (adjustmentType === 'ajuste') {
                movementQuantity = newStock - previousStock;
                newStock = quantity;
            }
            
            // Actualizar producto
            product.stock = newStock;
            
            // Registrar movimiento de stock
            const movement = {
                id: nextMovementId++,
                productId: productId,
                productName: product.name,
                type: adjustmentType,
                quantity: Math.abs(movementQuantity),
                previousStock: previousStock,
                newStock: newStock,
                notes: notes || `Ajuste de inventario (${adjustmentType})`,
                date: new Date().toISOString()
            };
            
            stockMovements.push(movement);
            
            // Guardar datos
            saveData();
            
            // Cerrar modal
            adjustStockModal.classList.remove('active');
            
            // Actualizar vistas
            loadProductsTable();
            loadProductsForSale();
            
            alert('Inventario actualizado exitosamente.');
        }

        // Cargar dashboard
        function loadDashboard() {
            // Calcular estadísticas
            const totalSales = sales.reduce((sum, sale) => sum + sale.total, 0);
            const totalProductsCount = products.length;
            const concentradosCount = products.filter(p => p.type === 'concentrado').length;
            const embolsadosCount = products.filter(p => p.type === 'embolsado').length;
            const lowStockCount = products.filter(p => p.stock <= p.minStock).length;
            
            // Ventas del mes actual
            const today = new Date();
            const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            const monthlySales = sales.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate >= startOfMonth && saleDate <= endOfMonth;
            }).reduce((sum, sale) => sum + sale.total, 0);
            
            // Actualizar tarjetas del dashboard
            document.getElementById('dashboardTotalSales').textContent = `${settings.currencySymbol}${totalSales.toFixed(2)}`;
            document.getElementById('dashboardTotalProducts').textContent = totalProductsCount;
            document.getElementById('dashboardProductTypes').textContent = `${concentradosCount} concentrados, ${embolsadosCount} embolsados`;
            document.getElementById('dashboardMonthlySales').textContent = `${settings.currencySymbol}${monthlySales.toFixed(2)}`;
            document.getElementById('dashboardLowStock').textContent = lowStockCount;
            
            // Cargar ventas recientes
            loadRecentSales();
            
            // Cargar productos por agotarse
            loadLowStockProducts();
            
            // Cargar top productos del mes
            loadMonthlyTopProducts();
        }

        // Cargar ventas recientes
        function loadRecentSales() {
            const recentSalesList = document.getElementById('recentSalesList');
            const recentSales = [...sales].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
            
            if (recentSales.length === 0) {
                recentSalesList.innerHTML = `
                    <p style="text-align: center; color: #666; padding: 20px;">
                        No hay ventas recientes.
                    </p>
                `;
                return;
            }
            
            let html = '';
            recentSales.forEach(sale => {
                const saleDate = new Date(sale.date);
                const formattedDate = saleDate.toLocaleDateString();
                const formattedTime = saleDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                html += `
                    <div style="padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600;">Venta #${sale.id}</div>
                            <div style="font-size: 0.8rem; color: #666;">${formattedDate} ${formattedTime}</div>
                        </div>
                        <div style="font-weight: 600; color: var(--success-color);">
                            ${settings.currencySymbol}${sale.total.toFixed(2)}
                        </div>
                    </div>
                `;
            });
            
            recentSalesList.innerHTML = html;
        }

        // Cargar productos por agotarse
        function loadLowStockProducts() {
            const lowStockProducts = document.getElementById('lowStockProducts');
            const lowStockItems = products.filter(p => p.stock <= p.minStock).slice(0, 5);
            
            if (lowStockItems.length === 0) {
                lowStockProducts.innerHTML = `
                    <p style="text-align: center; color: #666; padding: 20px;">
                        Todos los productos tienen inventario suficiente.
                    </p>
                `;
                return;
            }
            
            let html = '';
            lowStockItems.forEach(product => {
                const percentage = (product.stock / product.minStock * 100).toFixed(0);
                const statusClass = product.stock <= product.minStock ? 'inventory-low' : 'inventory-ok';
                
                html += `
                    <div style="padding: 10px; border-bottom: 1px solid #eee;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="font-weight: 600;">${product.name}</div>
                            <div class="${statusClass}" style="font-weight: 600;">${product.stock} / ${product.minStock}</div>
                        </div>
                        <div style="margin-top: 5px;">
                            <div style="height: 6px; background-color: #e9ecef; border-radius: 3px; overflow: hidden;">
                                <div style="height: 100%; width: ${Math.min(percentage, 100)}%; background-color: ${percentage <= 30 ? 'var(--danger-color)' : percentage <= 60 ? 'var(--warning-color)' : 'var(--success-color)'};"></div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            lowStockProducts.innerHTML = html;
        }

        // Cargar top productos del mes
        function loadMonthlyTopProducts() {
            const monthlyTopProducts = document.getElementById('monthlyTopProducts');
            
            // Calcular ventas del mes por producto
            const today = new Date();
            const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            let productSales = {};
            
            sales.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate >= startOfMonth && saleDate <= endOfMonth;
            }).forEach(sale => {
                sale.details.forEach(item => {
                    const product = products.find(p => p.id === item.productId);
                    if (product) {
                        if (!productSales[item.productId]) {
                            productSales[item.productId] = {
                                name: product.name,
                                type: product.type,
                                quantity: 0,
                                total: 0
                            };
                        }
                        productSales[item.productId].quantity += item.quantity;
                        productSales[item.productId].total += item.subtotal;
                    }
                });
            });
            
            // Convertir a array y ordenar
            const topProducts = Object.values(productSales)
                .sort((a, b) => b.quantity - a.quantity)
                .slice(0, 5);
            
            if (topProducts.length === 0) {
                monthlyTopProducts.innerHTML = `
                    <p style="text-align: center; color: #666; padding: 20px;">
                        No hay datos de ventas para este mes.
                    </p>
                `;
                return;
            }
            
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">';
            
            topProducts.forEach((product, index) => {
                const medal = index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : `${index + 1}.`;
                const badgeClass = product.type === 'concentrado' ? 'badge-concentrado' : 'badge-embolsado';
                const badgeText = product.type === 'concentrado' ? 'Concentrado' : 'Embolsado';
                
                html += `
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: var(--border-radius);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div style="font-size: 1.5rem;">${medal}</div>
                            <span class="badge ${badgeClass}">${badgeText}</span>
                        </div>
                        <div style="font-weight: 600; margin-bottom: 5px;">${product.name}</div>
                        <div style="font-size: 0.9rem; color: #666;">Vendidos: ${product.quantity}</div>
                        <div style="font-weight: 600; color: var(--success-color); margin-top: 5px;">
                            ${settings.currencySymbol}${product.total.toFixed(2)}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            monthlyTopProducts.innerHTML = html;
        }

        // Cargar reportes
        function loadReports() {
            // Obtener filtros
            const filterDate = reportDateInput.value;
            const filterType = reportTypeSelect.value;
            const filterRange = reportRangeSelect.value;
            
            let filteredSales = [...sales];
            let startDate, endDate;
            
            // Aplicar filtro de rango de fechas
            if (filterRange === 'hoy') {
                const today = new Date().toISOString().split('T')[0];
                filteredSales = sales.filter(sale => {
                    const saleDate = new Date(sale.date).toISOString().split('T')[0];
                    return saleDate === today;
                });
                startDate = today;
                endDate = today;
            } else if (filterRange === 'ayer') {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toISOString().split('T')[0];
                filteredSales = sales.filter(sale => {
                    const saleDate = new Date(sale.date).toISOString().split('T')[0];
                    return saleDate === yesterdayStr;
                });
                startDate = yesterdayStr;
                endDate = yesterdayStr;
            } else if (filterRange === 'semana') {
                const today = new Date();
                const startOfWeek = new Date(today);
                startOfWeek.setDate(today.getDate() - today.getDay());
                const endOfWeek = new Date(today);
                endOfWeek.setDate(today.getDate() + (6 - today.getDay()));
                
                filteredSales = sales.filter(sale => {
                    const saleDate = new Date(sale.date);
                    return saleDate >= startOfWeek && saleDate <= endOfWeek;
                });
                
                startDate = startOfWeek.toISOString().split('T')[0];
                endDate = endOfWeek.toISOString().split('T')[0];
            } else if (filterRange === 'mes') {
                const today = new Date();
                const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                
                filteredSales = sales.filter(sale => {
                    const saleDate = new Date(sale.date);
                    return saleDate >= startOfMonth && saleDate <= endOfMonth;
                });
                
                startDate = startOfMonth.toISOString().split('T')[0];
                endDate = endOfMonth.toISOString().split('T')[0];
            } else if (filterRange === 'personalizado') {
                startDate = startDateInput.value;
                endDate = endDateInput.value;
                
                if (startDate && endDate) {
                    filteredSales = sales.filter(sale => {
                        const saleDate = new Date(sale.date).toISOString().split('T')[0];
                        return saleDate >= startDate && saleDate <= endDate;
                    });
                }
            }
            
            // Aplicar filtro de tipo de producto si no es "todos"
            if (filterType !== 'todos') {
                filteredSales = filteredSales.map(sale => {
                    const filteredDetails = sale.details.filter(item => {
                        const product = products.find(p => p.id === item.productId);
                        return product && product.type === filterType;
                    });
                    
                    if (filteredDetails.length > 0) {
                        const subtotal = filteredDetails.reduce((sum, item) => sum + item.subtotal, 0);
                        const taxAmount = settings.taxRate > 0 ? subtotal * (settings.taxRate / 100) : 0;
                        const total = subtotal + taxAmount;
                        
                        return {
                            ...sale,
                            details: filteredDetails,
                            subtotal: subtotal,
                            taxAmount: taxAmount,
                            total: total
                        };
                    }
                    return null;
                }).filter(sale => sale !== null);
            }
            
            // Calcular estadísticas
            const totalSalesToday = filteredSales.reduce((sum, sale) => sum + sale.total, 0);
            const salesCountToday = filteredSales.length;
            const avgSaleToday = salesCountToday > 0 ? totalSalesToday / salesCountToday : 0;
            
            // Contar productos por tipo
            let concentradosCount = 0;
            let embolsadosCount = 0;
            let totalProductsSold = 0;
            
            filteredSales.forEach(sale => {
                sale.details.forEach(item => {
                    const product = products.find(p => p.id === item.productId);
                    if (product) {
                        totalProductsSold += item.quantity;
                        if (product.type === 'concentrado') {
                            concentradosCount += item.quantity;
                        } else {
                            embolsadosCount += item.quantity;
                        }
                    }
                });
            });
            
            // Productos con inventario bajo
            const lowInventoryCount = products.filter(p => p.stock <= p.minStock).length;
            
            // Actualizar tarjetas de resumen
            document.getElementById('salesTodayValue').textContent = `${settings.currencySymbol}${totalSalesToday.toFixed(2)}`;
            document.getElementById('salesTodayCount').textContent = `${salesCountToday} ventas`;
            document.getElementById('productsSoldValue').textContent = totalProductsSold;
            document.getElementById('productsSoldType').textContent = `${concentradosCount} concentrados, ${embolsadosCount} embolsados`;
            document.getElementById('avgSaleValue').textContent = `${settings.currencySymbol}${avgSaleToday.toFixed(2)}`;
            document.getElementById('lowInventoryValue').textContent = lowInventoryCount;
            
            // Cargar reportes específicos
            loadDailyReport(filteredSales);
            loadSalesReport(filteredSales);
            loadInventoryReport();
            loadProductsReport(filteredSales);
            
            // Restablecer página de ventas
            currentSalesPage = 1;
        }

        // Cargar más ventas en el reporte histórico
        function loadMoreSales() {
            currentSalesPage++;
            loadSalesReport([...sales]);
        }

        // Cargar reporte diario
        function loadDailyReport(filteredSales) {
            const dailyReportBody = document.getElementById('dailyReportBody');
            
            if (filteredSales.length === 0) {
                dailyReportBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <i class="fas fa-calendar-times" style="font-size: 3rem; color: #ddd; margin-bottom: 15px;"></i>
                            <p>No hay ventas para el período seleccionado.</p>
                        </td>
                    </tr>
                `;
                
                document.getElementById('dailySummaryDetails').innerHTML = `
                    <p>No hay datos de ventas para mostrar.</p>
                `;
                return;
            }
            
            // Ordenar ventas por fecha (más reciente primero)
            const sortedSales = [...filteredSales].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            dailyReportBody.innerHTML = '';
            
            sortedSales.forEach(sale => {
                const saleDate = new Date(sale.date);
                const formattedTime = saleDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                // Contar productos por tipo
                let concentrados = 0;
                let embolsados = 0;
                let totalItems = 0;
                
                sale.details.forEach(item => {
                    const product = products.find(p => p.id === item.productId);
                    if (product) {
                        totalItems += item.quantity;
                        if (product.type === 'concentrado') {
                            concentrados += item.quantity;
                        } else {
                            embolsados += item.quantity;
                        }
                    }
                });
                
                const productsSummary = `${totalItems} items (${concentrados} conc., ${embolsados} emb.)`;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formattedTime}</td>
                    <td>#${sale.id}</td>
                    <td>${productsSummary}</td>
                    <td>${totalItems}</td>
                    <td>${settings.currencySymbol}${sale.total.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewSaleDetail(${sale.id})" style="padding: 5px 10px; font-size: 0.9rem;">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                    </td>
                `;
                
                dailyReportBody.appendChild(row);
            });
            
            // Resumen del día
            const totalSales = sortedSales.reduce((sum, sale) => sum + sale.total, 0);
            const totalItemsSold = sortedSales.reduce((sum, sale) => 
                sum + sale.details.reduce((itemSum, item) => itemSum + item.quantity, 0), 0);
            
            document.getElementById('dailySummaryDetails').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 10px;">
                    <div>
                        <strong>Total Ventas:</strong> ${settings.currencySymbol}${totalSales.toFixed(2)}
                    </div>
                    <div>
                        <strong>Productos Vendidos:</strong> ${totalItemsSold}
                    </div>
                    <div>
                        <strong>Promedio por Venta:</strong> ${settings.currencySymbol}${(totalSales / sortedSales.length).toFixed(2)}
                    </div>
                    <div>
                        <strong>Venta Más Alta:</strong> ${settings.currencySymbol}${Math.max(...sortedSales.map(s => s.total)).toFixed(2)}
                    </div>
                </div>
            `;
        }

        // Cargar reporte histórico de ventas
        function loadSalesReport(filteredSales) {
            const salesReportBody = document.getElementById('salesReportBody');
            const totalSales = filteredSales.length;
            const startIndex = (currentSalesPage - 1) * SALES_PER_PAGE;
            const endIndex = Math.min(startIndex + SALES_PER_PAGE, totalSales);
            const salesToShow = filteredSales.slice(startIndex, endIndex);
            
            if (salesToShow.length === 0) {
                if (currentSalesPage === 1) {
                    salesReportBody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px;">
                                <i class="fas fa-shopping-cart" style="font-size: 3rem; color: #ddd; margin-bottom: 15px;"></i>
                                <p>No hay ventas para el período seleccionado.</p>
                            </td>
                        </tr>
                    `;
                } else {
                    salesReportBody.innerHTML += `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 20px;">
                                <p>No hay más ventas para mostrar.</p>
                            </td>
                        </tr>
                    `;
                }
                loadMoreSalesBtn.style.display = 'none';
                return;
            }
            
            if (currentSalesPage === 1) {
                salesReportBody.innerHTML = '';
            }
            
            salesToShow.forEach(sale => {
                const saleDate = new Date(sale.date);
                const formattedDate = saleDate.toLocaleDateString();
                
                // Contar productos por tipo
                let concentrados = 0;
                let embolsados = 0;
                let totalItems = 0;
                
                sale.details.forEach(item => {
                    const product = products.find(p => p.id === item.productId);
                    if (product) {
                        totalItems += item.quantity;
                        if (product.type === 'concentrado') {
                            concentrados += item.quantity;
                        } else {
                            embolsados += item.quantity;
                        }
                    }
                });
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>#${sale.id}</td>
                    <td>${concentrados}</td>
                    <td>${embolsados}</td>
                    <td>${totalItems}</td>
                    <td>${settings.currencySymbol}${sale.total.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewSaleDetail(${sale.id})" style="padding: 5px 10px; font-size: 0.9rem;">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                    </td>
                `;
                
                salesReportBody.appendChild(row);
            });
            
            // Mostrar u ocultar botón "Cargar más"
            if (endIndex < totalSales) {
                loadMoreSalesBtn.style.display = 'block';
                loadMoreSalesBtn.textContent = `Cargar Más (${endIndex} de ${totalSales})`;
            } else {
                loadMoreSalesBtn.style.display = 'none';
            }
        }

        // Cargar reporte de inventario
        function loadInventoryReport() {
            const inventoryReportBody = document.getElementById('inventoryReportBody');
            
            if (products.length === 0) {
                inventoryReportBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px;">
                            <i class="fas fa-box-open" style="font-size: 3rem; color: #ddd; margin-bottom: 15px;"></i>
                            <p>No hay productos en el inventario.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Ordenar productos por estado (bajo inventario primero)
            const sortedProducts = [...products].sort((a, b) => {
                const aStatus = a.stock <= a.minStock ? 0 : 1;
                const bStatus = b.stock <= b.minStock ? 0 : 1;
                return aStatus - bStatus;
            });
            
            inventoryReportBody.innerHTML = '';
            
            let totalValue = 0;
            let lowStockCount = 0;
            let outOfStockCount = 0;
            
            sortedProducts.forEach(product => {
                const statusClass = product.stock <= product.minStock ? 'inventory-low' : 'inventory-ok';
                const statusText = product.stock <= product.minStock ? 'BAJO' : (product.stock === 0 ? 'AGOTADO' : 'OK');
                const badgeClass = product.type === 'concentrado' ? 'badge-concentrado' : 'badge-embolsado';
                const badgeText = product.type === 'concentrado' ? 'Concentrado' : 'Embolsado';
                const productValue = product.cost * product.stock;
                totalValue += productValue;
                
                // Obtener último movimiento
                const lastMovement = stockMovements
                    .filter(m => m.productId === product.id)
                    .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                
                const lastMovementText = lastMovement ? 
                    `${new Date(lastMovement.date).toLocaleDateString()} (${lastMovement.type})` : 
                    'Sin movimientos';
                
                if (product.stock <= product.minStock) lowStockCount++;
                if (product.stock === 0) outOfStockCount++;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td><span class="badge ${badgeClass}">${badgeText}</span></td>
                    <td class="${statusClass}">${product.stock}</td>
                    <td>${product.minStock}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                    <td>${settings.currencySymbol}${productValue.toFixed(2)}</td>
                    <td>${lastMovementText}</td>
                `;
                
                inventoryReportBody.appendChild(row);
            });
            
            // Resumen de inventario
            document.getElementById('inventorySummaryDetails').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 10px;">
                    <div>
                        <strong>Valor Total Inventario:</strong> ${settings.currencySymbol}${totalValue.toFixed(2)}
                    </div>
                    <div>
                        <strong>Productos con Bajo Stock:</strong> ${lowStockCount}
                    </div>
                    <div>
                        <strong>Productos Agotados:</strong> ${outOfStockCount}
                    </div>
                    <div>
                        <strong>Productos Totales:</strong> ${products.length}
                    </div>
                </div>
            `;
        }

        // Cargar reporte de productos más vendidos
        function loadProductsReport(filteredSales) {
            const productsReportBody = document.getElementById('productsReportBody');
            
            // Calcular ventas por producto
            let productSales = {};
            
            filteredSales.forEach(sale => {
                sale.details.forEach(item => {
                    const product = products.find(p => p.id === item.productId);
                    if (product) {
                        if (!productSales[item.productId]) {
                            productSales[item.productId] = {
                                name: product.name,
                                type: product.type,
                                quantity: 0,
                                total: 0,
                                stock: product.stock
                            };
                        }
                        productSales[item.productId].quantity += item.quantity;
                        productSales[item.productId].total += item.subtotal;
                    }
                });
            });
            
            // Convertir a array y ordenar por cantidad vendida
            const sortedProducts = Object.values(productSales)
                .sort((a, b) => b.quantity - a.quantity);
            
            if (sortedProducts.length === 0) {
                productsReportBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px;">
                            <i class="fas fa-star" style="font-size: 3rem; color: #ddd; margin-bottom: 15px;"></i>
                            <p>No hay datos de ventas para mostrar productos más vendidos.</p>
                        </td>
                    </tr>
                `;
                
                document.getElementById('topProductsChart').innerHTML = `
                    <p>No hay datos suficientes para mostrar el ranking de productos.</p>
                `;
                return;
            }
            
            // Calcular total de ventas para porcentajes
            const totalSalesAll = sortedProducts.reduce((sum, p) => sum + p.total, 0);
            
            productsReportBody.innerHTML = '';
            
            sortedProducts.forEach((product, index) => {
                const position = index + 1;
                const badgeClass = product.type === 'concentrado' ? 'badge-concentrado' : 'badge-embolsado';
                const badgeText = product.type === 'concentrado' ? 'Concentrado' : 'Embolsado';
                const percentage = totalSalesAll > 0 ? (product.total / totalSalesAll * 100).toFixed(1) : 0;
                
                // Calcular rendimiento (ventas vs stock)
                const performance = product.stock > 0 ? 
                    ((product.quantity / product.stock) * 100).toFixed(1) : 
                    product.quantity > 0 ? '∞' : '0';
                
                const performanceClass = product.stock > 0 && (product.quantity / product.stock) > 0.5 ? 
                    'inventory-ok' : 'inventory-low';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        ${position === 1 ? '🥇' : position === 2 ? '🥈' : position === 3 ? '🥉' : position}
                    </td>
                    <td>${product.name}</td>
                    <td><span class="badge ${badgeClass}">${badgeText}</span></td>
                    <td>${product.quantity}</td>
                    <td>${settings.currencySymbol}${product.total.toFixed(2)}</td>
                    <td>${percentage}%</td>
                    <td>${product.stock}</td>
                    <td class="${performanceClass}">${performance}%</td>
                `;
                
                productsReportBody.appendChild(row);
            });
            
            // Gráfico de top productos (textual)
            const top5 = sortedProducts.slice(0, 5);
            let chartHTML = '<div style="margin-top: 10px;">';
            
            top5.forEach((product, index) => {
                const percentage = totalSalesAll > 0 ? (product.total / totalSalesAll * 100).toFixed(1) : 0;
                const barWidth = Math.min(percentage * 3, 100);
                
                chartHTML += `
                    <div style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <span>${index + 1}. ${product.name}</span>
                            <span>${percentage}% (${settings.currencySymbol}${product.total.toFixed(2)})</span>
                        </div>
                        <div style="height: 10px; background-color: #e9ecef; border-radius: 5px; overflow: hidden;">
                            <div style="height: 100%; width: ${barWidth}%; background-color: ${index === 0 ? '#ffc107' : index === 1 ? '#6c757d' : index === 2 ? '#dc3545' : '#17a2b8'};"></div>
                        </div>
                    </div>
                `;
            });
            
            chartHTML += '</div>';
            document.getElementById('topProductsChart').innerHTML = chartHTML;
        }

        // Ver detalles de una venta
        function viewSaleDetail(saleId) {
            const sale = sales.find(s => s.id === saleId);
            if (!sale) return;
            
            const saleDate = new Date(sale.date);
            const formattedDate = saleDate.toLocaleDateString() + ' ' + saleDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            document.getElementById('saleDetailId').textContent = sale.id;
            
            let detailsHTML = `
                <p><strong>Fecha:</strong> ${formattedDate}</p>
                <p><strong>Subtotal:</strong> ${settings.currencySymbol}${sale.subtotal.toFixed(2)}</p>
                ${sale.taxRate > 0 ? `<p><strong>Impuesto (${sale.taxRate}%):</strong> ${settings.currencySymbol}${sale.taxAmount.toFixed(2)}</p>` : ''}
                <p><strong>Total Venta:</strong> ${settings.currencySymbol}${sale.total.toFixed(2)}</p>
                <p><strong>Productos Vendidos:</strong> ${sale.details.length}</p>
                
                <h4 style="margin-top: 20px; margin-bottom: 15px;">Detalles de Productos</h4>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background-color: #f8f9fa;">
                                <th style="padding: 10px; text-align: left;">Producto</th>
                                <th style="padding: 10px; text-align: center;">Cantidad</th>
                                <th style="padding: 10px; text-align: right;">Precio</th>
                                <th style="padding: 10px; text-align: right;">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            let concentradosTotal = 0;
            let embolsadosTotal = 0;
            
            sale.details.forEach(item => {
                const product = products.find(p => p.id === item.productId);
                const productType = product ? product.type : 'desconocido';
                const badgeClass = productType === 'concentrado' ? 'badge-concentrado' : 'badge-embolsado';
                const badgeText = productType === 'concentrado' ? 'Concentrado' : 'Embolsado';
                
                if (productType === 'concentrado') {
                    concentradosTotal += item.subtotal;
                } else {
                    embolsadosTotal += item.subtotal;
                }
                
                detailsHTML += `
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">
                            ${item.name} <span class="badge ${badgeClass}">${badgeText}</span>
                        </td>
                        <td style="padding: 10px; text-align: center; border-bottom: 1px solid #eee;">${item.quantity}</td>
                        <td style="padding: 10px; text-align: right; border-bottom: 1px solid #eee;">${settings.currencySymbol}${item.price.toFixed(2)}</td>
                        <td style="padding: 10px; text-align: right; border-bottom: 1px solid #eee;">${settings.currencySymbol}${item.subtotal.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            detailsHTML += `
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3" style="padding: 10px; text-align: right; font-weight: bold;">Total Concentrados:</td>
                                <td style="padding: 10px; text-align: right; font-weight: bold;">${settings.currencySymbol}${concentradosTotal.toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td colspan="3" style="padding: 10px; text-align: right; font-weight: bold;">Total Embolsados:</td>
                                <td style="padding: 10px; text-align: right; font-weight: bold;">${settings.currencySymbol}${embolsadosTotal.toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td colspan="3" style="padding: 10px; text-align: right; font-weight: bold; color: var(--secondary-color);">SUBTOTAL:</td>
                                <td style="padding: 10px; text-align: right; font-weight: bold; color: var(--secondary-color);">${settings.currencySymbol}${sale.subtotal.toFixed(2)}</td>
                            </tr>
                            ${sale.taxRate > 0 ? `
                            <tr>
                                <td colspan="3" style="padding: 10px; text-align: right; font-weight: bold;">IMPUESTO (${sale.taxRate}%):</td>
                                <td style="padding: 10px; text-align: right; font-weight: bold;">${settings.currencySymbol}${sale.taxAmount.toFixed(2)}</td>
                            </tr>
                            ` : ''}
                            <tr>
                                <td colspan="3" style="padding: 10px; text-align: right; font-weight: bold; color: var(--primary-color);">TOTAL VENTA:</td>
                                <td style="padding: 10px; text-align: right; font-weight: bold; color: var(--primary-color);">${settings.currencySymbol}${sale.total.toFixed(2)}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;
            
            document.getElementById('saleDetailBody').innerHTML = detailsHTML;
            saleDetailModal.classList.add('active');
        }

        // Guardar información del negocio
        function saveBusinessInfo() {
            settings.businessName = document.getElementById('businessName').value;
            settings.businessAddress = document.getElementById('businessAddress').value;
            settings.businessPhone = document.getElementById('businessPhone').value;
            
            saveSettings();
            alert('Información del negocio guardada exitosamente.');
        }

        // Guardar configuración de ventas
        function saveSalesSettings() {
            settings.taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            settings.currencySymbol = document.getElementById('currencySymbol').value || '$';
            settings.receiptFooter = document.getElementById('receiptFooter').value;
            
            saveSettings();
            alert('Configuración de ventas guardada exitosamente.');
        }

        // Guardar apariencia
        function saveAppearance() {
            settings.themeColor = document.getElementById('themeColor').value;
            settings.language = document.getElementById('language').value;
            settings.darkMode = document.getElementById('darkMode').checked;
            
            saveSettings();
            alert('Configuración de apariencia guardada exitosamente. Recarga la página para ver los cambios.');
        }

        // Exportar datos
        function exportData() {
            const data = {
                products: products,
                sales: sales,
                stockMovements: stockMovements,
                nextIds: {
                    nextProductId: nextProductId,
                    nextSaleId: nextSaleId,
                    nextMovementId: nextMovementId
                },
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `candy_cami_backup_${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('Datos exportados exitosamente. Guarda el archivo en un lugar seguro.');
        }

        // Exportar todos los datos
        function exportAllData() {
            const data = {
                products: products,
                sales: sales,
                stockMovements: stockMovements,
                settings: settings,
                nextIds: {
                    nextProductId: nextProductId,
                    nextSaleId: nextSaleId,
                    nextMovementId: nextMovementId
                },
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `candy_cami_complete_backup_${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('Todos los datos exportados exitosamente. Guarda el archivo en un lugar seguro.');
        }

        // Exportar reporte a Excel (formato CSV)
        function exportReportToExcel() {
            const activeTab = document.querySelector('.tab-btn.active').getAttribute('data-tab');
            let csvContent = "data:text/csv;charset=utf-8,";
            
            if (activeTab === 'dailyReport') {
                csvContent += "Reporte Diario de Ventas\n";
                csvContent += "Hora,ID Venta,Productos,Cantidad Total,Total Venta\n";
                
                const rows = document.querySelectorAll('#dailyReportBody tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 5) {
                        const rowData = [
                            cells[0].textContent,
                            cells[1].textContent,
                            cells[2].textContent.replace(/,/g, ';'),
                            cells[3].textContent,
                            cells[4].textContent
                        ];
                        csvContent += rowData.join(",") + "\n";
                    }
                });
            } else if (activeTab === 'salesReport') {
                csvContent += "Reporte Histórico de Ventas\n";
                csvContent += "Fecha,ID Venta,Concentrados,Embolsados,Total Productos,Total Venta\n";
                
                const rows = document.querySelectorAll('#salesReportBody tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 6) {
                        const rowData = [
                            cells[0].textContent,
                            cells[1].textContent,
                            cells[2].textContent,
                            cells[3].textContent,
                            cells[4].textContent,
                            cells[5].textContent
                        ];
                        csvContent += rowData.join(",") + "\n";
                    }
                });
            } else if (activeTab === 'inventoryReport') {
                csvContent += "Reporte de Estado de Inventario\n";
                csvContent += "ID,Producto,Tipo,Stock Actual,Stock Mínimo,Estado,Valor en Inventario,Último Movimiento\n";
                
                const rows = document.querySelectorAll('#inventoryReportBody tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 8) {
                        const rowData = [
                            cells[0].textContent,
                            cells[1].textContent,
                            cells[2].textContent.replace('Concentrado', 'Concentrado').replace('Embolsado', 'Embolsado'),
                            cells[3].textContent,
                            cells[4].textContent,
                            cells[5].textContent,
                            cells[6].textContent,
                            cells[7].textContent
                        ];
                        csvContent += rowData.join(",") + "\n";
                    }
                });
            } else if (activeTab === 'productsReport') {
                csvContent += "Productos Más Vendidos\n";
                csvContent += "Posición,Producto,Tipo,Unidades Vendidas,Total en Ventas,% del Total,Stock Actual,Rendimiento\n";
                
                const rows = document.querySelectorAll('#productsReportBody tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 8) {
                        const rowData = [
                            cells[0].textContent.replace('🥇', '1').replace('🥈', '2').replace('🥉', '3'),
                            cells[1].textContent,
                            cells[2].textContent.replace('Concentrado', 'Concentrado').replace('Embolsado', 'Embolsado'),
                            cells[3].textContent,
                            cells[4].textContent,
                            cells[5].textContent.replace('%', ''),
                            cells[6].textContent,
                            cells[7].textContent.replace('%', '')
                        ];
                        csvContent += rowData.join(",") + "\n";
                    }
                });
            }
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `reporte_${activeTab}_${new Date().toISOString().slice(0,10)}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('Reporte exportado exitosamente como archivo CSV.');
        }

        // Importar datos
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!importedData.products || !Array.isArray(importedData.products)) {
                        throw new Error('El archivo no contiene datos válidos.');
                    }
                    
                    if (confirm('¿Estás seguro de que deseas importar estos datos? Esto reemplazará todos los datos actuales.')) {
                        // Restaurar datos
                        products = importedData.products;
                        sales = importedData.sales || [];
                        stockMovements = importedData.stockMovements || [];
                        
                        if (importedData.nextIds) {
                            nextProductId = importedData.nextIds.nextProductId || Math.max(...products.map(p => p.id), 0) + 1;
                            nextSaleId = importedData.nextIds.nextSaleId || 1;
                            nextMovementId = importedData.nextIds.nextMovementId || 1;
                        } else {
                            nextProductId = Math.max(...products.map(p => p.id), 0) + 1;
                            nextSaleId = sales.length > 0 ? Math.max(...sales.map(s => s.id), 0) + 1 : 1;
                            nextMovementId = stockMovements.length > 0 ? Math.max(...stockMovements.map(m => m.id), 0) + 1 : 1;
                        }
                        
                        // Guardar datos
                        saveData();
                        
                        // Actualizar vistas
                        loadProductsTable();
                        loadProductsForSale();
                        cart = [];
                        updateCartDisplay();
                        
                        alert('Datos importados exitosamente.');
                    }
                } catch (error) {
                    console.error('Error importando datos:', error);
                    alert('Error al importar datos: ' + error.message);
                }
                
                // Limpiar input de archivo
                importFileInput.value = '';
            };
            
            reader.readAsText(file);
        }

        // Importar configuración
        function importSettings(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!importedData.settings) {
                        throw new Error('El archivo no contiene configuración válida.');
                    }
                    
                    if (confirm('¿Estás seguro de que deseas importar esta configuración?')) {
                        settings = importedData.settings;
                        saveSettings();
                        loadSettingsForm();
                        alert('Configuración importada exitosamente. Recarga la página para ver los cambios.');
                    }
                } catch (error) {
                    console.error('Error importando configuración:', error);
                    alert('Error al importar configuración: ' + error.message);
                }
                
                // Limpiar input de archivo
                importFileInput.value = '';
            };
            
            reader.readAsText(file);
        }

        // Restablecer datos
        function resetData() {
            if (confirm('¿ESTÁS ABSOLUTAMENTE SEGURO? Esto eliminará todos los productos, ventas y movimientos.')) {
                if (confirm('¿ÚLTIMA OPORTUNIDAD? Se perderán todos los datos de productos y ventas.')) {
                    // Restablecer variables
                    products = [
                        { id: 1, name: "Concentrado Michelada Clásica", type: "concentrado", price: 25.00, cost: 12.50, stock: 15, minStock: 10 },
                        { id: 2, name: "Concentrado Michelada Tamarindo", type: "concentrado", price: 28.00, cost: 14.00, stock: 8, minStock: 10 },
                        { id: 3, name: "Concentrado Michelada Mango", type: "concentrado", price: 28.00, cost: 14.00, stock: 12, minStock: 10 },
                        { id: 4, name: "Cacahuates Japoneses", type: "embolsado", price: 15.00, cost: 8.00, stock: 25, minStock: 15 },
                        { id: 5, name: "Gomitas de Sandía", type: "embolsado", price: 12.00, cost: 6.00, stock: 30, minStock: 15 },
                        { id: 6, name: "Papas Sabritas", type: "embolsado", price: 18.00, cost: 9.00, stock: 10, minStock: 15 }
                    ];
                    sales = [];
                    stockMovements = [];
                    cart = [];
                    nextProductId = 7;
                    nextSaleId = 1;
                    nextMovementId = 1;
                    
                    // Guardar datos
                    saveData();
                    
                    // Actualizar vistas
                    loadProductsTable();
                    loadProductsForSale();
                    updateCartDisplay();
                    
                    alert('Datos restablecidos exitosamente. La aplicación ahora tiene datos de ejemplo.');
                }
            }
        }

        // Limpiar todos los datos
        function clearAllData() {
            if (confirm('¿ESTÁS ABSOLUTAMENTE SEGURO? Esto eliminará TODOS los datos incluyendo productos, ventas, movimientos y configuración.')) {
                if (confirm('¿ÚLTIMA OPORTUNIDAD? Esto no se puede deshacer.')) {
                    // Eliminar todos los datos de localStorage
                    for (let key in STORAGE_KEYS) {
                        localStorage.removeItem(STORAGE_KEYS[key]);
                    }
                    
                    // Restablecer todas las variables
                    products = [];
                    sales = [];
                    stockMovements = [];
                    cart = [];
                    nextProductId = 1;
                    nextSaleId = 1;
                    nextMovementId = 1;
                    settings = {
                        businessName: "Candy Cami",
                        businessAddress: "",
                        businessPhone: "",
                        taxRate: 16,
                        currencySymbol: "$",
                        receiptFooter: "¡Gracias por su compra! Vuelva pronto.",
                        themeColor: "default",
                        language: "es",
                        darkMode: false
                    };
                    
                    // Actualizar vistas
                    loadProductsTable();
                    loadProductsForSale();
                    updateCartDisplay();
                    loadSettingsForm();
                    
                    alert('Todos los datos han sido eliminados. La aplicación ha sido restablecida completamente.');
                }
            }
        }

        // Hacer funciones disponibles globalmente
        window.decreaseQuantity = decreaseQuantity;
        window.increaseQuantity = increaseQuantity;
        window.editProduct = editProduct;
        window.deleteProduct = deleteProduct;
        window.adjustStockModalOpen = adjustStockModalOpen;
        window.adjustStock = adjustStock;
        window.viewSaleDetail = viewSaleDetail;
    </script>
</body>
</html>